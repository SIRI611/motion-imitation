import pickle  
import numpy as np
  
# 使用pickle从文件加载数组  
with open('weight_data.pkl', 'rb') as f:  
    allresult = pickle.load(f)  

PN = allresult['PN']
PNtoKCweight = allresult['PNtoKCweight']
activate_KC_dims = allresult['activate_KC_dims']
KCtoMBONweight = allresult['KCtoMBONweight']

KC = PN @ PNtoKCweight
sorted_indices = np.argsort(KC, axis=1)[:, ::-1]  
inactivate_indices = sorted_indices[:, activate_KC_dims:]  
KC[np.arange(KC.shape[0])[:, None], inactivate_indices] = 0
MBON = KC @ KCtoMBONweight
print(MBON)



"""
False

o[:12],o[12:24],o[48:60]
[ 4.72117770e-04  6.30009073e-03  6.15232580e-07  3.02447404e-07
  4.72117770e-04  6.30009073e-03  3.11491476e-07  1.97299528e-07
  4.72117770e-04  6.30009073e-03 -2.92843705e-08  7.16017183e-08] 

[ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] 

[ 3.23257017e-04  6.84543396e-01 -1.28736208e+00  3.23178350e-04
  6.84261690e-01 -1.28668770e+00  1.32613840e-04  6.76969233e-01
 -1.27398253e+00  1.32557475e-04  6.76722579e-01 -1.27336992e+00]
False
[4.72162216e-04 6.30013509e-03 8.67360257e-07 3.79193779e-07
 4.72117770e-04 6.30009073e-03 6.15232580e-07 3.02447404e-07
 4.72117770e-04 6.30009073e-03 3.11491476e-07 1.97299528e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23273278e-04  6.84543437e-01 -1.28736210e+00  3.23194603e-04
  6.84261714e-01 -1.28668768e+00  1.32623500e-04  6.76969258e-01
 -1.27398252e+00  1.32567129e-04  6.76722589e-01 -1.27336987e+00]
False
[4.72162216e-04 6.30013509e-03 1.05789786e-06 4.22270148e-07
 4.72162216e-04 6.30013509e-03 8.67360257e-07 3.79193779e-07
 4.72117770e-04 6.30009073e-03 6.15232580e-07 3.02447404e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23296787e-04  6.84543484e-01 -1.28736212e+00  3.23218101e-04
  6.84261740e-01 -1.28668766e+00  1.32631215e-04  6.76969286e-01
 -1.27398251e+00  1.32574837e-04  6.76722600e-01 -1.27336982e+00]
False
[4.72162216e-04 6.30013509e-03 1.18123455e-06 4.29337973e-07
 4.72162216e-04 6.30013509e-03 1.05789786e-06 4.22270148e-07
 4.72162216e-04 6.30013509e-03 8.67360257e-07 3.79193779e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23326053e-04  6.84543532e-01 -1.28736215e+00  3.23247352e-04
  6.84261768e-01 -1.28668763e+00  1.32636521e-04  6.76969315e-01
 -1.27398250e+00  1.32580136e-04  6.76722613e-01 -1.27336976e+00]
False
[4.72251522e-04 6.30022451e-03 1.23557220e-06 4.01084890e-07
 4.72162216e-04 6.30013509e-03 1.18123455e-06 4.29337973e-07
 4.72162216e-04 6.30013509e-03 1.05789786e-06 4.22270148e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23358893e-04  6.84543578e-01 -1.28736218e+00  3.23280176e-04
  6.84261795e-01 -1.28668759e+00  1.32639625e-04  6.76969342e-01
 -1.27398250e+00  1.32583232e-04  6.76722626e-01 -1.27336970e+00]
False
[4.72266516e-04 6.30023941e-03 1.22224992e-06 3.41069779e-07
 4.72251522e-04 6.30022451e-03 1.23557220e-06 4.01084890e-07
 4.72162216e-04 6.30013509e-03 1.18123455e-06 4.29337973e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23392655e-04  6.84543619e-01 -1.28736221e+00  3.23313922e-04
  6.84261817e-01 -1.28668756e+00  1.32641270e-04  6.76969365e-01
 -1.27398250e+00  1.32584868e-04  6.76722637e-01 -1.27336965e+00]
False
[4.72355805e-04 6.30021000e-03 1.14512716e-06 2.55334839e-07
 4.72266516e-04 6.30023941e-03 1.22224992e-06 3.41069779e-07
 4.72251522e-04 6.30022451e-03 1.23557220e-06 4.01084890e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23424526e-04  6.84543653e-01 -1.28736224e+00  3.23345778e-04
  6.84261832e-01 -1.28668753e+00  1.32642477e-04  6.76969385e-01
 -1.27398250e+00  1.32586067e-04  6.76722644e-01 -1.27336960e+00]
False
[4.72385351e-04 6.30023945e-03 1.01014086e-06 1.51825020e-07
 4.72355805e-04 6.30021000e-03 1.14512716e-06 2.55334839e-07
 4.72266516e-04 6.30023941e-03 1.22224992e-06 3.41069779e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23451874e-04  6.84543677e-01 -1.28736226e+00  3.23373114e-04
  6.84261839e-01 -1.28668750e+00  1.32644256e-04  6.76969399e-01
 -1.27398251e+00  1.32587839e-04  6.76722646e-01 -1.27336957e+00]
False
[4.72385351e-04 6.30023945e-03 8.25078359e-07 3.96665030e-08
 4.72385351e-04 6.30023945e-03 1.01014086e-06 1.51825020e-07
 4.72355805e-04 6.30021000e-03 1.14512716e-06 2.55334839e-07] [ 0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25  0.    0.67 -1.25] [ 3.23472572e-04  6.84543690e-01 -1.28736228e+00  3.23393802e-04
  6.84261838e-01 -1.28668748e+00  1.32647319e-04  6.76969408e-01
 -1.27398253e+00  1.32590896e-04  6.76722643e-01 -1.27336955e+00]"""